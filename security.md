当考虑到MySQL安装中的安全问题时，你应该考虑一系列可能的主题，以及它们如何影响你的MySQL服务器和相关应用程序的安全。

影响安全的一般因素。这些因素包括选择好的密码、不授予用户不必要的权限、通过防止SQL注入和数据损坏来确保应用安全，以及其他。见第6.1节，"一般安全问题"。

任何在连接到互联网的计算机上使用MySQL的人都应该阅读本节，以避免最常见的安全错误。

在讨论安全问题时，有必要考虑全面保护整个服务器主机（而不仅仅是MySQL服务器），防止所有类型的适用攻击：窃听、更改、回放和拒绝服务。我们在此不涉及可用性和容错的所有方面。

MySQL对所有连接、查询和其他用户可以尝试执行的操作使用基于访问控制列表（ACL）的安全性。还支持MySQL客户端和服务器之间的SSL加密连接。这里讨论的许多概念根本不是针对MySQL的；同样的一般想法适用于几乎所有的应用。

当运行MySQL时，请遵循这些准则。

永远不要给任何人（除了MySQL根账户）访问mysql系统数据库中的用户表的权限！这一点至关重要。这一点很关键。

了解MySQL访问权限系统如何工作（见第6.2节，"访问控制和帐户管理"）。使用GRANT和REVOKE语句来控制对MySQL的访问。不要授予多于必要的权限。永远不要向所有主机授予权限。

checklist

尝试mysql -u root。如果你能够成功地连接到服务器而不被要求提供密码，任何人都可以作为具有完全权限的MySQL根用户连接到你的MySQL服务器! 查看MySQL安装说明，特别注意关于设置根密码的信息。见第2.10.4节，"保证初始MySQL帐户的安全"。

使用SHOW GRANTS语句来检查哪些账户可以访问什么。然后使用REVOKE语句删除那些不需要的权限。

不要在你的数据库中存储明文密码。如果你的计算机被入侵，入侵者可以获取完整的密码列表并使用它们。相反，使用SHA2()或其他单向散列函数并存储散列值。

为了防止使用彩虹表恢复密码，不要在普通密码上使用这些函数；相反，选择一些字符串作为盐，并使用hash(hash(password)+salt)值。

不要从字典中选择密码。有专门的程序来破解密码。即使像 "xfish98 "这样的密码也是非常糟糕的。好得多的是 "duag98"，它包含相同的 "鱼 "字，但在标准的QWERTY键盘上向左输入一个键。另一种方法是使用从句子中每个单词的第一个字符中提取的密码（例如，"Four score and seven years ago "的结果是密码为 "Fsasya"）。这个密码很容易记忆和输入，但对于不知道这个句子的人来说，很难猜到。在这种情况下，你可以另外用数字代替数字词，得到 "4 score and 7 years ago "这句话，得到的密码是 "4sa7ya"，这就更难猜了。

投资一个防火墙。这可以保护你免受任何软件中至少50%的所有类型的漏洞。把MySQL放在防火墙后面或放在非军事区（DMZ）。

checklist

尝试使用nmap等工具从互联网上扫描你的端口。MySQL默认使用端口3306。这个端口不应该从不被信任的主机访问。作为检查你的MySQL端口是否开放的一个简单方法，从一些远程机器尝试以下命令，其中server_host是你的MySQL服务器运行的主机名称或IP地址。

shell> telnet server_host 3306
如果telnet挂起或连接被拒绝，说明该端口被封锁了，这是你希望的情况。如果你得到一个连接和一些垃圾字符，该端口是开放的，应该在你的防火墙或路由器上关闭，除非你真的有一个很好的理由保持它的开放。

访问MySQL的应用程序不应该相信用户输入的任何数据，应该使用适当的防御性编程技术来编写。见第6.1.7节，"客户端编程安全指南"。

不要在互联网上传输普通（未加密的）数据。这些信息可以被每一个有时间和能力的人截获并用于他们自己的目的。相反，使用加密的协议，如SSL或SSH。MySQL支持内部SSL连接。另一种技术是使用SSH端口转发，为通信创建一个加密（和压缩）的隧道。

学习使用tcpdump和strings工具。在大多数情况下，你可以通过发出类似以下的命令来检查MySQL数据流是否未被加密。

shell> tcpdump -l -i eth0 -w - src or dst port 3306 | strings
这在Linux下是可行的，在其他系统下只要稍作修改就可以了。

警告
如果你没有看到明文数据，这并不总是意味着信息实际上是加密的。如果你需要高安全性，请向安全专家咨询。

MySQL用户应使用以下准则来保持密码的安全。

当你运行客户端程序连接到MySQL服务器时，以暴露给其他用户发现的方式指定你的密码是不可取的。这里列出了你在运行客户端程序时可以用来指定你的密码的方法，以及对每种方法的风险评估。简而言之，最安全的方法是让客户程序提示密码，或在适当保护的选项文件中指定密码。

使用mysql_config_editor工具，它使你能够在一个名为.mylogin.cnf的加密登录路径文件中存储认证凭证。该文件以后可以被MySQL客户端程序读取，以获得连接到MySQL服务器的认证凭证。见第4.6.6节，"mysql_config_editor--MySQL配置工具"。

在命令行中使用-密码=password或-ppassword选项。例如

shell> mysql -u francis -pfrank db_name
警告
这很方便，但不安全。在一些系统上，你的密码对系统状态程序（如ps）是可见的，这些程序可能被其他用户调用来显示命令行。MySQL客户端通常在其初始化序列中用零覆盖命令行密码参数。然而，仍然有一个短暂的间隔，在此期间该值是可见的。另外，在一些系统上，这种覆盖策略是无效的，密码对ps来说仍然是可见的。(SystemV Unix系统，也许其他系统也有这个问题)。

如果你的操作环境被设置为在终端窗口的标题栏中显示当前的命令，那么只要命令在运行，密码仍然是可见的，即使命令已经在窗口内容区中滚出了视野。

在命令行中使用-密码或-p选项，而不指定密码值。在这种情况下，客户程序会以交互方式征求密码。

shell> mysql -u francis -p db_name
输入密码。********
*字符表示你输入密码的地方。密码不会在你输入时显示。

以这种方式输入密码比在命令行上指定密码更安全，因为它对其他用户不可见。然而，这种输入密码的方法只适合于你以交互方式运行的程序。如果你想从一个非交互式运行的脚本中调用一个客户端，就没有机会从键盘上输入密码了。在某些系统中，你甚至会发现你的脚本的第一行被读取并被解释为你的密码（不正确）。

把你的密码储存在一个选项文件中。例如，在Unix系统中，你可以在主目录下的.my.cnf文件的[client]部分列出你的密码。

[client]
密码=password
为了保证密码的安全，除了你自己，任何人都不应该访问该文件。为了确保这一点，将文件的访问模式设置为400或600。例如。

shell> chmod 600 .my.cnf
要从命令行命名包含密码的特定选项文件，请使用-defaults-file=file_name选项，其中file_name是文件的全路径名称。例如

shell> mysql --defaults-file=/home/francis/mysql-opts
第4.2.2.2节，"使用选项文件"，更详细地讨论了选项文件。

在MYSQL_PWD环境变量中存储你的密码。参见第4.9节，"环境变量"。

这种指定你的MySQL密码的方法必须被认为是极其不安全的，不应该被使用。某些版本的ps包括一个显示运行进程环境的选项。在某些系统上，如果你设置了MYSQL_PWD，你的密码就会暴露给任何其他运行ps的用户。即使在没有这样的ps版本的系统上，认为没有其他方法可以让用户检查进程环境也是不明智的。

在Unix上，mysql客户端将已执行语句的记录写入历史文件（见第4.5.1.3节，"mysql客户端日志"）。默认情况下，这个文件被命名为.mysql_history，并在你的主目录中创建。密码可以作为纯文本写入SQL语句中，如CREATE USER和ALTER USER，所以如果你使用这些语句，它们会被记录在历史文件中。为了保证这个文件的安全，请使用限制性访问模式，与前面描述的.my.cnf文件的方式相同。

如果你的命令解释器被配置为维护历史记录，任何保存命令的文件都包含在命令行上输入的MySQL密码。例如，bash使用~/.bash_history。任何这样的文件都应该有一个限制性的访问模式。

数据库管理员应使用以下准则来保证密码的安全。

MySQL在mysql.user系统表中存储用户账户的密码。对这个表的访问不应该被授予任何非管理员账户。

帐户密码可以过期，以便用户必须重新设置。见第6.2.11节 "密码管理 "和第6.2.12节 "服务器对过期密码的处理"。

validate_password插件可以用来强制执行可接受的密码策略。请参阅第6.4.3节，"密码验证插件"。

有权限修改插件目录（plugin_dir系统变量的值）或指定插件目录位置的my.cnf文件的用户可以替换插件并修改插件提供的功能，包括验证插件。

对于可能写入密码的日志文件等文件应加以保护。见第6.1.2.3节，"密码和日志"。

密码可以在SQL语句中写成纯文本，如CREATE USER、GRANT、SET PASSWORD，以及调用PASSWORD()函数的语句。如果这些语句被MySQL服务器记录下来，其中的密码就会被任何能够访问日志的人看到。

语句日志避免了将以下语句的密码写成明文。

CREATE USER ... IDENTIFIED BY ...
ALTER USER ... IDENTIFIED BY ...
GRANT ... IDENTIFIED BY ...
SET PASSWORD ...
SLAVE START ... PASSWORD = ...
CREATE SERVER ... OPTIONS(... PASSWORD ...)
ALTER SERVER ... OPTIONS(... PASSWORD ...)

这些语句中的密码被重写，不会出现在一般查询日志、慢速查询日志和二进制日志的语句文本中。重写并不适用于其他语句。特别是，mysql.user系统表的INSERT或UPDATE语句，如果引用字面密码，就会按原样记录，所以你应该避免这种语句。(无论如何，直接修改授予表是不可取的)。

对于一般查询日志，可以通过使用 --log-raw 选项启动服务器来抑制密码的重写。由于安全原因，不建议在生产中使用这个选项。出于诊断的目的，看到服务器收到的语句的确切文本可能是有用的。

由审计日志插件产生的审计日志文件的内容是不加密的。出于安全原因，该文件应被写入一个只有MySQL服务器和有合法理由查看该日志的用户可以访问的目录。见第6.4.5.3节，"MySQL企业审计安全考虑"。

如果安装了查询重写插件，服务器收到的语句可能被重写（见查询重写插件）。在这种情况下，--log-raw选项对语句记录的影响如下。

如果没有--log-raw，服务器会记录由查询重写插件返回的语句。这可能与收到的语句不同。

使用--log-raw，服务器会记录收到的原始语句。

密码重写的一个含义是，不能被解析的语句（例如，由于语法错误）不会被写入一般的查询日志，因为它们不能被知道是无密码。需要记录所有语句（包括有错误的语句）的用例应该使用--log-raw选项，记住这也绕过了密码重写。

密码重写只发生在期望有纯文本密码的情况下。对于语法上期望有密码哈希值的语句，不会发生重写。如果在这种语法中错误地提供了纯文本密码，密码会被记录下来，而不进行重写。例如，下面的语句被记录为所示，因为预期有一个密码哈希值。

CREATE USER 'user1'@'localhost' IDENTIFIED BY PASSWORD 'not-so-secret';
为了保护日志文件不被无端曝光，把它们放在一个限制服务器和数据库管理员访问的目录中。如果服务器记录到mysql数据库中的表，那么只允许数据库管理员访问这些表。

复制在源信息存储库中存储复制源的密码，源信息存储库可以是一个文件或一个表（见第16.2.4节，"中继日志和复制元数据存储库"）。确保该存储库只能由数据库管理员访问。在文件中存储密码的一个替代方法是使用START SLAVE语句来指定连接到源的凭证。

使用限制访问模式来保护包括含有密码的日志表或日志文件的数据库备份。

密码hash处理：https://dev.mysql.com/doc/refman/5.7/en/password-hashing.html

Making MySQL Secure Against Attackers：https://dev.mysql.com/doc/refman/5.7/en/security-against-attack.html

Security-Related mysqld Options and Variables

Client Programming Security Guidelines：https://dev.mysql.com/doc/refman/5.7/en/secure-client-programming.html





安装本身的安全。你安装的数据文件、日志文件和所有的应用程序文件都应该受到保护，以确保它们不能被未经授权的人读取或写入。欲了解更多信息，请参见第2.10节，"安装后的设置和测试"。



数据库系统本身的访问控制和安全性，包括授予访问数据库、视图和数据库内使用的存储程序的用户和数据库。更多信息请参见第6.2节，"访问控制和账户管理"。



与安全有关的插件所提供的功能。见第6.4节，"安全插件"。



MySQL和你的系统的网络安全。安全性与单个用户的授予有关，但你也可能希望限制MySQL，使其仅在MySQL服务器主机的本地可用，或对一组有限的其他主机可用。



确保你对你的数据库文件、配置和日志文件有充分和适当的备份。还要确保你有一个恢复方案，并测试你能够成功地从备份中恢复信息。见第7章，备份和恢复。

